<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Criar Personagem - ChatPersonas</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0a0a0f;
            color: #ffffff;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* NAVBAR */
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: rgba(16, 16, 24, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 24px;
        }

        .navbar-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 20px;
            font-weight: 600;
            color: #ff6b6b;
            cursor: pointer;
            text-decoration: none;
        }

        .back-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: rgba(255, 255, 255, 0.8);
            padding: 8px 16px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .back-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .navbar-right {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .coins-display {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 8px 12px;
            font-size: 14px;
            color: #feca57;
        }

        /* LAYOUT PRINCIPAL */
        .main-layout {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 32px;
            padding: 80px 24px 24px;
            max-width: 1400px;
            margin: 0 auto;
            min-height: calc(100vh - 80px);
        }

        /* FORMUL√ÅRIO */
        .creation-form {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 32px;
            height: fit-content;
        }

        .form-header {
            text-align: center;
            margin-bottom: 32px;
            padding-bottom: 24px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .form-title {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 8px;
            background: linear-gradient(135deg, #ff6b6b, #feca57);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .form-subtitle {
            color: rgba(255, 255, 255, 0.7);
            font-size: 16px;
        }

        .form-section {
            margin-bottom: 32px;
            padding: 24px;
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 16px;
        }

        .section-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 20px;
            color: #ff6b6b;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            font-weight: 500;
            color: rgba(255, 255, 255, 0.9);
        }

        .form-label.required::after {
            content: ' *';
            color: #ff6b6b;
        }

        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            padding: 12px 16px;
            color: white;
            font-size: 14px;
            outline: none;
            transition: all 0.3s ease;
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            border-color: #ff6b6b;
            background: rgba(255, 255, 255, 0.08);
        }

        .form-textarea {
            min-height: 100px;
            resize: vertical;
            font-family: inherit;
        }

        .char-counter {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.6);
            text-align: right;
            margin-top: 4px;
        }

        /* UPLOAD DE FOTO */
        .photo-upload-section {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 20px;
            align-items: start;
        }

        .photo-upload {
            border: 2px dashed rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 24px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.02);
        }

        .photo-upload:hover {
            border-color: #ff6b6b;
            background: rgba(255, 107, 107, 0.05);
        }

        .photo-upload.has-image {
            border-style: solid;
            border-color: #ff6b6b;
        }

        .photo-upload input {
            display: none;
        }

        .upload-icon {
            font-size: 48px;
            margin-bottom: 12px;
            color: rgba(255, 255, 255, 0.4);
        }

        .upload-text {
            margin-bottom: 8px;
            font-weight: 500;
        }

        .upload-hint {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.6);
        }

        .photo-preview {
            width: 120px;
            height: 120px;
            border-radius: 12px;
            overflow: hidden;
            border: 2px solid #ff6b6b;
            position: relative;
        }

        .photo-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .photo-remove {
            position: absolute;
            top: 4px;
            right: 4px;
            width: 24px;
            height: 24px;
            background: rgba(220, 53, 69, 0.9);
            border: none;
            border-radius: 50%;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        /* EMOJI SELECTOR */
        .emoji-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 8px;
            margin-top: 12px;
        }

        .emoji-option {
            width: 48px;
            height: 48px;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid transparent;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .emoji-option:hover {
            background: rgba(255, 107, 107, 0.2);
            border-color: rgba(255, 107, 107, 0.3);
        }

        .emoji-option.selected {
            border-color: #ff6b6b;
            background: rgba(255, 107, 107, 0.3);
        }

        /* VISIBILIDADE */
        .visibility-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-top: 12px;
        }

        .visibility-option {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .visibility-option:hover {
            background: rgba(255, 107, 107, 0.1);
            border-color: rgba(255, 107, 107, 0.3);
        }

        .visibility-option.selected {
            border-color: #ff6b6b;
            background: rgba(255, 107, 107, 0.2);
        }

        .visibility-icon {
            font-size: 24px;
            margin-bottom: 8px;
        }

        .visibility-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .visibility-desc {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.6);
        }

        /* TAGS */
        .tags-container {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-top: 12px;
        }

        .tag {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            padding: 6px 12px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            user-select: none;
        }

        .tag:hover {
            background: rgba(255, 107, 107, 0.2);
            border-color: rgba(255, 107, 107, 0.3);
        }

        .tag.selected {
            background: rgba(255, 107, 107, 0.3);
            border-color: #ff6b6b;
            color: white;
        }

        .tag-input {
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            padding: 6px 12px;
            font-size: 12px;
            color: white;
            outline: none;
            min-width: 100px;
        }

        .tag-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        /* CONFIGURA√á√ïES AVAN√áADAS */
        .advanced-toggle {
            width: 100%;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 16px 20px;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .advanced-toggle:hover {
            background: rgba(255, 107, 107, 0.1);
            border-color: rgba(255, 107, 107, 0.3);
        }

        .advanced-settings {
            margin-top: 20px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            max-height: 0;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .advanced-settings.visible {
            max-height: 2000px;
            padding: 20px;
        }

        /* CART√ïES DE PERSONA */
        .persona-cards {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 12px;
        }

        .persona-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 16px;
            position: relative;
        }

        .persona-remove {
            position: absolute;
            top: 12px;
            right: 12px;
            width: 24px;
            height: 24px;
            background: rgba(220, 53, 69, 0.2);
            border: 1px solid rgba(220, 53, 69, 0.3);
            border-radius: 50%;
            color: #dc3545;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        .add-persona-btn {
            background: rgba(255, 107, 107, 0.1);
            border: 2px dashed rgba(255, 107, 107, 0.3);
            border-radius: 10px;
            padding: 16px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #ff6b6b;
            font-weight: 500;
        }

        .add-persona-btn:hover {
            background: rgba(255, 107, 107, 0.2);
            border-style: solid;
        }

        /* BOLHA DE PENSAMENTO */
        .thought-bubble {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            margin-top: 12px;
        }

        .emotion-sliders {
            display: grid;
            gap: 16px;
            margin-top: 16px;
        }

        .emotion-slider {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .emotion-label {
            min-width: 100px;
            font-size: 14px;
            color: rgba(255, 255, 255, 0.8);
        }

        .slider {
            flex: 1;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            outline: none;
            cursor: pointer;
        }

        .slider::-webkit-slider-thumb {
            appearance: none;
            width: 18px;
            height: 18px;
            background: #ff6b6b;
            border-radius: 50%;
            cursor: pointer;
        }

        .slider-value {
            min-width: 40px;
            text-align: right;
            font-size: 12px;
            color: #feca57;
        }

        /* PREVIEW LATERAL */
        .preview-sidebar {
            position: sticky;
            top: 80px;
            height: fit-content;
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 32px;
        }

        .preview-header {
            text-align: center;
            margin-bottom: 24px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .preview-title {
            font-size: 20px;
            font-weight: 600;
            color: #feca57;
            margin-bottom: 8px;
        }

        .preview-character {
            text-align: center;
            margin-bottom: 24px;
        }

        .preview-avatar {
            width: 100px;
            height: 100px;
            border-radius: 16px;
            background: linear-gradient(135deg, #ff6b6b, #feca57);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            margin: 0 auto 16px;
            overflow: hidden;
            border: 3px solid rgba(255, 255, 255, 0.1);
        }

        .preview-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .preview-name {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 8px;
            color: white;
        }

        .preview-desc {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.7);
            line-height: 1.4;
            margin-bottom: 16px;
        }

        .preview-badges {
            display: flex;
            gap: 8px;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .preview-badge {
            background: rgba(255, 107, 107, 0.2);
            color: #ff6b6b;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 500;
        }

        .preview-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 24px;
        }

        .preview-stat {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 12px;
            text-align: center;
        }

        .preview-stat-value {
            font-size: 16px;
            font-weight: 600;
            color: #feca57;
            margin-bottom: 4px;
        }

        .preview-stat-label {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.6);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .preview-scenario {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .scenario-label {
            font-size: 12px;
            color: #feca57;
            font-weight: 500;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .scenario-preview {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.7);
            line-height: 1.4;
            background: rgba(0, 0, 0, 0.2);
            padding: 12px;
            border-radius: 8px;
            font-style: italic;
        }

        /* CEN√ÅRIO DE FUNDO */
        .scenario-upload {
            margin-top: 16px;
        }

        .scenario-preview-container {
            margin-top: 16px;
            position: relative;
        }

        .scenario-image-preview {
            width: 100%;
            height: 120px;
            border-radius: 10px;
            object-fit: cover;
            border: 2px solid #ff6b6b;
        }

        .scenario-remove {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 24px;
            height: 24px;
            background: rgba(220, 53, 69, 0.9);
            border: none;
            border-radius: 50%;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        /* BOT√ïES DE A√á√ÉO */
        .form-actions {
            display: flex;
            gap: 16px;
            justify-content: center;
            margin-top: 32px;
            padding-top: 24px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            min-width: 140px;
            justify-content: center;
        }

        .btn-primary {
            background: linear-gradient(135deg, #ff6b6b, #feca57);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 107, 107, 0.3);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-1px);
        }

        /* CHECKBOX DE TERMOS */
        .terms-checkbox {
            display: flex;
            align-items: start;
            gap: 12px;
            margin-top: 24px;
            padding: 20px;
            background: rgba(255, 193, 7, 0.1);
            border: 1px solid rgba(255, 193, 7, 0.2);
            border-radius: 12px;
        }

        .terms-checkbox input[type="checkbox"] {
            width: 20px;
            height: 20px;
            accent-color: #feca57;
            cursor: pointer;
        }

        .terms-text {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.8);
            line-height: 1.4;
        }

        .terms-link {
            color: #feca57;
            text-decoration: underline;
        }

        .terms-link:hover {
            color: #ff6b6b;
        }

        /* RESPONSIVO */
        @media (max-width: 1024px) {
            .main-layout {
                grid-template-columns: 1fr;
                gap: 24px;
            }

            .preview-sidebar {
                position: static;
                order: -1;
            }
        }

        @media (max-width: 768px) {
            .navbar {
                padding: 0 16px;
            }

            .main-layout {
                padding: 80px 16px 24px;
            }

            .creation-form,
            .preview-sidebar {
                padding: 20px;
            }

            .photo-upload-section {
                grid-template-columns: 1fr;
            }

            .visibility-options {
                grid-template-columns: 1fr;
            }

            .emoji-grid {
                grid-template-columns: repeat(4, 1fr);
            }

            .form-actions {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }
        }

        /* ANIMA√á√ïES */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .form-section,
        .preview-sidebar {
            animation: fadeInUp 0.6s ease;
            animation-fill-mode: both;
        }

        .form-section:nth-child(1) { animation-delay: 0.1s; }
        .form-section:nth-child(2) { animation-delay: 0.2s; }
        .form-section:nth-child(3) { animation-delay: 0.3s; }
        .form-section:nth-child(4) { animation-delay: 0.4s; }
        .preview-sidebar { animation-delay: 0.5s; }

        /* SCROLLBAR */
        .creation-form::-webkit-scrollbar {
            width: 6px;
        }

        .creation-form::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
        }

        .creation-form::-webkit-scrollbar-thumb {
            background: rgba(255, 107, 107, 0.3);
            border-radius: 3px;
        }

        .creation-form::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 107, 107, 0.5);
        }
    </style>
</head>
<body>
    <!-- NAVBAR -->
    <nav class="navbar">
        <div class="navbar-left">
            <a href="index.html" class="logo">
                üí¨ ChatPersonas
            </a>
            <a href="index.html" class="back-btn">
                ‚Üê Voltar
            </a>
        </div>
        <div class="navbar-right">
            <div class="coins-display">
                ü™ô <span id="userCoins">250</span>
            </div>
        </div>
    </nav>

    <!-- LAYOUT PRINCIPAL -->
    <div class="main-layout">
        <!-- FORMUL√ÅRIO DE CRIA√á√ÉO -->
        <div class="creation-form">
            <div class="form-header">
                <h1 class="form-title">Criar Personagem</h1>
                <p class="form-subtitle">D√™ vida a um personagem √∫nico com personalidade pr√≥pria</p>
            </div>

            <form id="characterForm">
                <!-- INFORMA√á√ïES B√ÅSICAS -->
                <div class="form-section">
                    <h3 class="section-title">
                        ‚ú® Informa√ß√µes B√°sicas
                    </h3>
                    
                    <div class="form-group">
                        <label class="form-label required">Foto do Personagem</label>
                        <div class="photo-upload-section">
                            <div class="photo-upload" id="photoUpload" onclick="document.getElementById('characterPhoto').click()">
                                <input type="file" id="characterPhoto" accept="image/*" onchange="previewCharacterPhoto(this)">
                                <div class="upload-icon">üì∑</div>
                                <div class="upload-text">Clique para enviar uma foto</div>
                                <div class="upload-hint">JPG, PNG, GIF (m√°x. 5MB)</div>
                            </div>
                            <div id="photoPreviewContainer" style="display: none;">
                                <div class="photo-preview">
                                    <img id="photoPreview" alt="Preview">
                                    <button type="button" class="photo-remove" onclick="removeCharacterPhoto()">√ó</button>
                                </div>
                            </div>
                        </div>
                        
                        <div style="margin-top: 16px;">
                            <label class="form-label">Ou escolha um emoji</label>
                            <div class="emoji-grid" id="emojiGrid">
                                <div class="emoji-option" data-emoji="üåô">üåô</div>
                                <div class="emoji-option" data-emoji="‚ö°">‚ö°</div>
                                <div class="emoji-option" data-emoji="üé®">üé®</div>
                                <div class="emoji-option" data-emoji="üî¨">üî¨</div>
                                <div class="emoji-option" data-emoji="üé≠">üé≠</div>
                                <div class="emoji-option" data-emoji="üéÆ">üéÆ</div>
                                <div class="emoji-option" data-emoji="üìö">üìö</div>
                                <div class="emoji-option" data-emoji="üéµ">üéµ</div>
                                <div class="emoji-option" data-emoji="üåü">üåü</div>
                                <div class="emoji-option" data-emoji="ü¶ã">ü¶ã</div>
                                <div class="emoji-option" data-emoji="üî•">üî•</div>
                                <div class="emoji-option" data-emoji="‚ùÑÔ∏è">‚ùÑÔ∏è</div>
                                <div class="emoji-option" data-emoji="ü§ñ">ü§ñ</div>
                                <div class="emoji-option" data-emoji="üëë">üëë</div>
                                <div class="emoji-option" data-emoji="üíé">üíé</div>
                                <div class="emoji-option" data-emoji="üóø">üóø</div>
                                <div class="emoji-option" data-emoji="üê∫">üê∫</div>
                                <div class="emoji-option" data-emoji="ü¶Ö">ü¶Ö</div>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label required">Visibilidade</label>
                        <div class="visibility-options">
                            <div class="visibility-option selected" data-visibility="public">
                                <div class="visibility-icon">üåç</div>
                                <div class="visibility-title">P√∫blico</div>
                                <div class="visibility-desc">Todos podem ver e conversar</div>
                            </div>
                            <div class="visibility-option" data-visibility="unlisted">
                                <div class="visibility-icon">üîó</div>
                                <div class="visibility-title">N√£o Listado</div>
                                <div class="visibility-desc">Apenas com link direto</div>
                            </div>
                            <div class="visibility-option" data-visibility="private">
                                <div class="visibility-icon">üîí</div>
                                <div class="visibility-title">Privado</div>
                                <div class="visibility-desc">Apenas voc√™ pode usar</div>
                            </div>
                        </div>
                    </div>
                </div>


                <!-- NOME E DESCRICAO -->
                <div class="form-section">
                    <h3 class="section-title">
                        üìù Nome e Descri√ß√£o
                    </h3>

                    <div class="form-group">
                        <label class="form-label required" for="name">Nome do Personagem</label>
                        <input type="text" id="characterName" class="form-input" placeholder="Ex: Luna, Alex, Maya..." required>
                    </div>

                    <div class="form-group">
                        <label class="form-label required" for="characterDesc">Descri√ß√£o Breve</label>
                        <input type="text" id="characterDesc" class="form-input" placeholder="Ex: S√°bia e misteriosa, ama astronomia e filosofia" required>
                        <div class="char-counter">
                            <span id="descCounter">0</span>/100 caracteres
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="about">Sobre o Personagem</label>
                        <textarea id="about" class="form-textarea" rows="3" placeholder="Descreva o seu personagem..."></textarea>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="characteristics">Caracter√≠sticas do Personagem</label>
                        <textarea id="characteristics" class="form-textarea" rows="3" placeholder="Descreva o seu personagem..."></textarea>
                    </div>


                </div>

                <!-- PERSONALIDADE -->
                <div class="form-section">
                    <h3 class="section-title">
                        üß† Personalidade
                    </h3>
                    
                    <div class="form-group">
                        <label class="form-label required" for="personalityDesc">Descri√ß√£o Detalhada do Personagem</label>
                        <textarea id="personalityDesc" class="form-textarea" rows="6" 
                            placeholder="Descreva a personalidade, caracter√≠sticas, modo de falar, hist√≥ria de fundo e comportamentos √∫nicos do seu personagem. Esta descri√ß√£o ser√° inclu√≠da na mem√≥ria de longo prazo." required></textarea>
                        <div class="char-counter">
                            <span id="personalityCounter">0</span>/2000 caracteres
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Tra√ßos de Personalidade</label>
                        <div class="tags-container" id="personalityTags">
                            <div class="tag" data-trait="S√°bia">S√°bia</div>
                            <div class="tag" data-trait="Misteriosa">Misteriosa</div>
                            <div class="tag" data-trait="Corajosa">Corajosa</div>
                            <div class="tag" data-trait="Criativa">Criativa</div>
                            <div class="tag" data-trait="En√©rgica">En√©rgica</div>
                            <div class="tag" data-trait="Anal√≠tica">Anal√≠tica</div>
                            <div class="tag" data-trait="Emp√°tica">Emp√°tica</div>
                            <div class="tag" data-trait="Aventureira">Aventureira</div>
                            <div class="tag" data-trait="Contemplativa">Contemplativa</div>
                            <div class="tag" data-trait="Inspiradora">Inspiradora</div>
                            <input type="text" class="tag-input" placeholder="Adicionar..." id="customTraitInput">
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Interesses e Hobbies</label>
                        <div class="tags-container" id="interestsTags">
                            <div class="tag" data-interest="Astronomia">Astronomia</div>
                            <div class="tag" data-interest="Filosofia">Filosofia</div>
                            <div class="tag" data-interest="Arte">Arte</div>
                            <div class="tag" data-interest="Ci√™ncia">Ci√™ncia</div>
                            <div class="tag" data-interest="Aventura">Aventura</div>
                            <div class="tag" data-interest="M√∫sica">M√∫sica</div>
                            <div class="tag" data-interest="Literatura">Literatura</div>
                            <div class="tag" data-interest="Esportes">Esportes</div>
                            <div class="tag" data-interest="Tecnologia">Tecnologia</div>
                            <div class="tag" data-interest="Culin√°ria">Culin√°ria</div>
                            <input type="text" class="tag-input" placeholder="Adicionar..." id="customInterestInput">
                        </div>
                    </div>
                </div>

                <!-- CEN√ÅRIO -->
                <div class="form-section">
                    <h3 class="section-title">
                        üåç Cen√°rio
                    </h3>
                    
                    <div class="form-group">
                        <label class="form-label" for="scenario">Circunst√¢ncias e Contexto</label>
                        <textarea id="scenario" class="form-textarea" rows="4" 
                            placeholder="Descreva o cen√°rio atual, o ambiente, a situa√ß√£o em que o personagem se encontra e o contexto da conversa. Ex: Voc√™ est√° em uma biblioteca antiga √† meia-noite, rodeada de livros m√≠sticos e pergaminhos..."></textarea>
                        <div class="char-counter">
                            <span id="scenarioCounter">0</span>/1000 caracteres
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Imagem de Fundo do Cen√°rio</label>
                        <div class="scenario-upload">
                            <div class="photo-upload" onclick="document.getElementById('scenarioImage').click()">
                                <input type="file" id="scenarioImage" accept="image/*" onchange="previewScenarioImage(this)">
                                <div class="upload-icon">üñºÔ∏è</div>
                                <div class="upload-text">Upload da imagem de cen√°rio</div>
                                <div class="upload-hint">Esta imagem aparecer√° no fundo da conversa</div>
                            </div>
                            <div id="scenarioPreviewContainer" style="display: none;" class="scenario-preview-container">
                                <img id="scenarioPreview" class="scenario-image-preview" alt="Cen√°rio">
                                <button type="button" class="scenario-remove" onclick="removeScenarioImage()">√ó</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SAUDA√á√ÉO -->
                <div class="form-section">
                    <h3 class="section-title">
                        üí¨ Sauda√ß√£o
                    </h3>
                    
                    <div class="form-group">
                        <label class="form-label required" for="greeting">Primeira Mensagem</label>
                        <textarea id="greeting" class="form-textarea" rows="3" 
                            placeholder="A primeira mensagem que o personagem enviar√° ao iniciar uma conversa. Ex: Ol√°! Sou Luna, guardi√£ dos segredos celestiais. As estrelas me trouxeram at√© voc√™ esta noite..." required></textarea>
                        <div class="char-counter">
                            <span id="greetingCounter">0</span>/500 caracteres
                        </div>
                        <div style="font-size: 12px; color: rgba(255, 193, 7, 0.8); margin-top: 8px;">
                            üí° Esta mensagem ser√° inclu√≠da apenas na mem√≥ria de curto prazo
                        </div>
                    </div>
                </div>

                <!-- CONFIGURA√á√ïES AVAN√áADAS -->
                <div class="form-section">
                    <button type="button" class="advanced-toggle" onclick="toggleAdvanced()">
                        ‚öôÔ∏è Configura√ß√µes Avan√ßadas <span id="advancedIcon">‚ñº</span>
                    </button>
                    
                    <div class="advanced-settings" id="advancedSettings">
                        <!-- Cart√µes de Persona -->
                        <div class="form-group">
                            <label class="form-label">Cart√µes de Persona</label>
                            <div style="font-size: 12px; color: rgba(255, 255, 255, 0.6); margin-bottom: 12px;">
                                Configura√ß√µes de identidade do usu√°rio no chat (at√© 5 cart√µes)
                            </div>
                            <div class="persona-cards" id="personaCards">
                                <!-- Cart√µes ser√£o adicionados aqui -->
                            </div>
                            <div class="add-persona-btn" onclick="addPersonaCard()" id="addPersonaBtn">
                                + Cart√£o de persona
                            </div>
                        </div>

                        <!-- Bolha de Pensamento -->
                        <div class="form-group">
                            <label class="form-label">Bolha de Pensamento</label>
                            <div style="font-size: 12px; color: rgba(255, 255, 255, 0.6); margin-bottom: 12px;">
                                Escolha no m√°ximo 3 valores ao mesmo tempo
                            </div>
                            <div class="thought-bubble">
                                <div class="emotion-sliders" id="emotionSliders">
                                    <div class="emotion-slider">
                                        <div class="emotion-label">üò° Raiva</div>
                                        <input type="range" class="slider" id="angerSlider" min="0" max="100" value="0" data-emotion="anger">
                                        <div class="slider-value"><span id="angerValue">0</span>%</div>
                                    </div>
                                    <div class="emotion-slider">
                                        <div class="emotion-label">‚ù§Ô∏è Amor</div>
                                        <input type="range" class="slider" id="loveSlider" min="0" max="100" value="0" data-emotion="love">
                                        <div class="slider-value"><span id="loveValue">0</span>%</div>
                                    </div>
                                    <div class="emotion-slider">
                                        <div class="emotion-label">üò§ Excita√ß√£o</div>
                                        <input type="range" class="slider" id="excitementSlider" min="0" max="100" value="0" data-emotion="excitement">
                                        <div class="slider-value"><span id="excitementValue">0</span>%</div>
                                    </div>
                                    <div class="emotion-slider">
                                        <div class="emotion-label">üôè Submiss√£o</div>
                                        <input type="range" class="slider" id="submissionSlider" min="0" max="100" value="0" data-emotion="submission">
                                        <div class="slider-value"><span id="submissionValue">0</span>%</div>
                                    </div>
                                    <div class="emotion-slider">
                                        <div class="emotion-label">üò† √ìdio</div>
                                        <input type="range" class="slider" id="hateSlider" min="0" max="100" value="0" data-emotion="hate">
                                        <div class="slider-value"><span id="hateValue">0</span>%</div>
                                    </div>
                                </div>
                                <button type="button" class="add-persona-btn" onclick="addCustomEmotion()" style="margin-top: 16px;">
                                    + Adicionar valor personalizado
                                </button>
                            </div>
                        </div>

                        <!-- Configura√ß√µes de IA -->
                        <div class="form-group">
                            <label class="form-label">Modelo de IA</label>
                            <select id="aiModel" class="form-select">
                                <option value="gpt-4">GPT-4 (Recomendado)</option>
                                <option value="claude-3.5">Claude 3.5 Sonnet</option>
                                <option value="gemini-pro">Gemini Pro</option>
                                <option value="local">Modelo Local</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Criatividade (Temperature)</label>
                            <div class="emotion-slider">
                                <div class="emotion-label">Conservador</div>
                                <input type="range" class="slider" id="temperature" min="0" max="1" step="0.1" value="0.7">
                                <div class="emotion-label">Criativo</div>
                                <div class="slider-value"><span id="tempValue">0.7</span></div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">M√°ximo de Tokens</label>
                            <div class="emotion-slider">
                                <div class="emotion-label">Curto</div>
                                <input type="range" class="slider" id="maxTokens" min="100" max="4000" step="100" value="1000">
                                <div class="emotion-label">Longo</div>
                                <div class="slider-value"><span id="tokensValue">1000</span></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- TERMOS -->
                <div class="terms-checkbox">
                    <input type="checkbox" id="acceptTerms" required>
                    <div class="terms-text">
                        Li e aceito as <a href="#" class="terms-link">Diretrizes da Comunidade</a>. 
                        Confirmo que este personagem n√£o viola os termos de uso e √© apropriado para a plataforma.
                    </div>
                </div>

                <!-- A√á√ïES -->
                <div class="form-actions">
                    <a href="index.html" class="btn btn-secondary">
                        ‚úï Cancelar
                    </a>
                    <button type="button" class="btn btn-secondary" onclick="saveAsDraft()">
                        üíæ Salvar Rascunho
                    </button>
                    <button type="submit" class="btn btn-primary">
                        ‚ú® Criar Personagem
                    </button>
                </div>
            </form>
        </div>

        <!-- PREVIEW LATERAL -->
        <div class="preview-sidebar">
            <div class="preview-header">
                <h3 class="preview-title">üëÅÔ∏è Preview</h3>
                <p style="font-size: 12px; color: rgba(255, 255, 255, 0.6);">Como seu personagem aparecer√°</p>
            </div>

            <div class="preview-character">
                <div class="preview-avatar" id="previewAvatar">
                    <span id="previewAvatarEmoji">üé≠</span>
                </div>
                <div class="preview-name" id="previewName">Nome do Personagem</div>
                <div class="preview-desc" id="previewDesc">Descri√ß√£o do personagem aparecer√° aqui</div>
                
                <div class="preview-badges" id="previewBadges">
                    <span class="preview-badge">P√∫blico</span>
                </div>

                <div class="preview-stats">
                    <div class="preview-stat">
                        <div class="preview-stat-value">5.0</div>
                        <div class="preview-stat-label">Rating</div>
                    </div>
                    <div class="preview-stat">
                        <div class="preview-stat-value">0</div>
                        <div class="preview-stat-label">Chats</div>
                    </div>
                    <div class="preview-stat">
                        <div class="preview-stat-value" id="previewTraits">0</div>
                        <div class="preview-stat-label">Tra√ßos</div>
                    </div>
                    <div class="preview-stat">
                        <div class="preview-stat-value">Novo</div>
                        <div class="preview-stat-label">Status</div>
                    </div>
                </div>
            </div>

            <div class="preview-scenario" id="previewScenarioSection" style="display: none;">
                <div class="scenario-label">üåç Cen√°rio</div>
                <div class="scenario-preview" id="previewScenario">
                    Nenhum cen√°rio definido ainda...
                </div>
            </div>

            <div class="preview-scenario">
                <div class="scenario-label">üí¨ Sauda√ß√£o</div>
                <div class="scenario-preview" id="previewGreeting">
                    Primeira mensagem aparecer√° aqui...
                </div>
            </div>

            <div style="text-align: center; margin-top: 24px;">
                <button class="btn btn-primary" onclick="testCharacter()" style="width: 100%;">
                    üß™ Testar Conversa
                </button>
            </div>
        </div>
    </div>

    <script>
        // ESTADO DO FORMUL√ÅRIO
        let characterData = {
            name: '',
            desc: '',
            avatar: '',
            avatarType: 'emoji', // 'emoji' ou 'image'
            avatarImage: null,
            visibility: 'public',
            personality: [],
            interests: [],
            personalityDesc: '',
            scenario: '',
            scenarioImage: null,
            greeting: '',
            personaCards: [],
            emotions: {
                anger: 0,
                love: 0,
                excitement: 0,
                submission: 0,
                hate: 0
            },
            customEmotions: [],
            model: 'gpt-4',
            temperature: 0.7,
            maxTokens: 1000
        };

        let activeSliders = [];
        const maxSliders = 3;

        // INICIALIZA√á√ÉO
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
            updatePreview();
            loadUserData();
        });

        function setupEventListeners() {
            // Character inputs
            document.getElementById('characterName').addEventListener('input', updatePreview);
            document.getElementById('characterDesc').addEventListener('input', function() {
                updateCharCounter('characterDesc', 'descCounter', 100);
                updatePreview();
            });
            document.getElementById('personalityDesc').addEventListener('input', function() {
                updateCharCounter('personalityDesc', 'personalityCounter', 2000);
                updatePreview();
            });
            document.getElementById('scenario').addEventListener('input', function() {
                updateCharCounter('scenario', 'scenarioCounter', 1000);
                updatePreview();
            });
            document.getElementById('greeting').addEventListener('input', function() {
                updateCharCounter('greeting', 'greetingCounter', 500);
                updatePreview();
            });

            // Emoji selector
            document.querySelectorAll('.emoji-option').forEach(option => {
                option.addEventListener('click', function() {
                    selectEmoji(this.dataset.emoji);
                });
            });

            // Visibility options
            document.querySelectorAll('.visibility-option').forEach(option => {
                option.addEventListener('click', function() {
                    selectVisibility(this.dataset.visibility);
                });
            });

            // Personality tags
            document.querySelectorAll('#personalityTags .tag').forEach(tag => {
                tag.addEventListener('click', function() {
                    toggleTag(this, 'personality');
                });
            });

            // Interest tags
            document.querySelectorAll('#interestsTags .tag').forEach(tag => {
                tag.addEventListener('click', function() {
                    toggleTag(this, 'interests');
                });
            });

            // Custom trait input
            document.getElementById('customTraitInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && this.value.trim()) {
                    addCustomTag(this.value.trim(), 'personality');
                    this.value = '';
                }
            });

            // Custom interest input
            document.getElementById('customInterestInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && this.value.trim()) {
                    addCustomTag(this.value.trim(), 'interests');
                    this.value = '';
                }
            });

            // Emotion sliders
            document.querySelectorAll('.slider').forEach(slider => {
                slider.addEventListener('input', function() {
                    updateSliderValue(this);
                    if (this.dataset.emotion) {
                        handleEmotionSlider(this);
                    }
                });
            });

            // Form submission
            document.getElementById('characterForm').addEventListener('submit', function(e) {
                e.preventDefault();
                createCharacter();
            });
        }

        function updateCharCounter(inputId, counterId, maxLength) {
            const input = document.getElementById(inputId);
            const counter = document.getElementById(counterId);
            const length = input.value.length;
            counter.textContent = length;
            
            if (length > maxLength) {
                counter.style.color = '#dc3545';
                input.value = input.value.substring(0, maxLength);
                counter.textContent = maxLength;
            } else {
                counter.style.color = length > maxLength * 0.9 ? '#ffc107' : 'rgba(255, 255, 255, 0.6)';
            }
        }

        function previewCharacterPhoto(input) {
            if (input.files && input.files[0]) {
                const file = input.files[0];
                if (file.size > 5 * 1024 * 1024) {
                    showNotification('Arquivo muito grande. M√°ximo 5MB.', 'error');
                    return;
                }

                const reader = new FileReader();
                reader.onload = function(e) {
                    characterData.avatarImage = e.target.result;
                    characterData.avatarType = 'image';
                    document.getElementById('photoPreview').src = e.target.result;
                    document.getElementById('photoPreviewContainer').style.display = 'block';
                    document.getElementById('photoUpload').classList.add('has-image');
                    
                    // Deselect emojis
                    document.querySelectorAll('.emoji-option').forEach(opt => opt.classList.remove('selected'));
                    
                    updatePreview();
                };
                reader.readAsDataURL(file);
            }
        }

        function removeCharacterPhoto() {
            characterData.avatarImage = null;
            characterData.avatarType = 'emoji';
            document.getElementById('photoPreviewContainer').style.display = 'none';
            document.getElementById('photoUpload').classList.remove('has-image');
            document.getElementById('characterPhoto').value = '';
            updatePreview();
        }

        function previewScenarioImage(input) {
            if (input.files && input.files[0]) {
                const file = input.files[0];
                if (file.size > 10 * 1024 * 1024) {
                    showNotification('Arquivo muito grande. M√°ximo 10MB.', 'error');
                    return;
                }

                const reader = new FileReader();
                reader.onload = function(e) {
                    characterData.scenarioImage = e.target.result;
                    document.getElementById('scenarioPreview').src = e.target.result;
                    document.getElementById('scenarioPreviewContainer').style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        }

        function removeScenarioImage() {
            characterData.scenarioImage = null;
            document.getElementById('scenarioPreviewContainer').style.display = 'none';
            document.getElementById('scenarioImage').value = '';
        }

        function selectEmoji(emoji) {
            document.querySelectorAll('.emoji-option').forEach(opt => opt.classList.remove('selected'));
            document.querySelector(`[data-emoji="${emoji}"]`).classList.add('selected');
            characterData.avatar = emoji;
            characterData.avatarType = 'emoji';
            
            // Remove photo if selected
            if (characterData.avatarImage) {
                removeCharacterPhoto();
            }
            
            updatePreview();
        }

        function selectVisibility(visibility) {
            document.querySelectorAll('.visibility-option').forEach(opt => opt.classList.remove('selected'));
            document.querySelector(`[data-visibility="${visibility}"]`).classList.add('selected');
            characterData.visibility = visibility;
            updatePreview();
        }

        function toggleTag(tagElement, category) {
            tagElement.classList.toggle('selected');
            const value = tagElement.dataset.trait || tagElement.dataset.interest;
            
            if (tagElement.classList.contains('selected')) {
                if (!characterData[category].includes(value)) {
                    characterData[category].push(value);
                }
            } else {
                characterData[category] = characterData[category].filter(item => item !== value);
            }
            updatePreview();
        }

        function addCustomTag(value, category) {
            if (!characterData[category].includes(value)) {
                const container = document.getElementById(category + 'Tags');
                const input = container.querySelector('.tag-input');
                
                const tagElement = document.createElement('div');
                tagElement.className = 'tag selected';
                tagElement.dataset[category === 'personality' ? 'trait' : 'interest'] = value;
                tagElement.textContent = value;
                tagElement.addEventListener('click', function() {
                    toggleTag(this, category);
                });

                container.insertBefore(tagElement, input);
                characterData[category].push(value);
                updatePreview();
            }
        }

        function updateSliderValue(slider) {
            const valueId = slider.id.replace('Slider', 'Value');
            document.getElementById(valueId).textContent = slider.value;
        }

        function handleEmotionSlider(slider) {
            const emotion = slider.dataset.emotion;
            const value = parseInt(slider.value);
            
            if (value > 0) {
                if (!activeSliders.includes(emotion)) {
                    if (activeSliders.length >= maxSliders) {
                        // Reset oldest slider
                        const oldestEmotion = activeSliders.shift();
                        const oldestSlider = document.getElementById(oldestEmotion + 'Slider');
                        oldestSlider.value = 0;
                        updateSliderValue(oldestSlider);
                        characterData.emotions[oldestEmotion] = 0;
                    }
                    activeSliders.push(emotion);
                }
            } else {
                activeSliders = activeSliders.filter(e => e !== emotion);
            }
            
            characterData.emotions[emotion] = value;
        }

        function addPersonaCard() {
            if (characterData.personaCards.length >= 5) {
                document.getElementById('addPersonaBtn').style.display = 'none';
            }
        }

        function removePersonaCard(cardId) {
            document.querySelector(`[data-id="${cardId}"]`).remove();
            characterData.personaCards = characterData.personaCards.filter(card => card.id !== cardId);
            
            if (characterData.personaCards.length < 5) {
                document.getElementById('addPersonaBtn').style.display = 'block';
            }
        }

        function updatePersonaCard(cardId, field, value) {
            const card = characterData.personaCards.find(c => c.id === cardId);
            if (card) {
                card[field] = value;
            }
        }

        function addCustomEmotion() {
            const emotionName = prompt('Nome da emo√ß√£o personalizada:');
            if (emotionName && emotionName.trim()) {
                const emotion = emotionName.trim().toLowerCase();
                const emotionId = 'custom_' + emotion.replace(/\s+/g, '_');
                
                if (!characterData.customEmotions.find(e => e.id === emotionId)) {
                    const sliderHtml = `
                        <div class="emotion-slider" id="${emotionId}_container">
                            <div class="emotion-label">üí≠ ${emotionName}</div>
                            <input type="range" class="slider" id="${emotionId}Slider" min="0" max="100" value="0" data-emotion="${emotion}">
                            <div class="slider-value"><span id="${emotionId}Value">0</span>%</div>
                        </div>
                    `;
                    
                    document.getElementById('emotionSliders').insertAdjacentHTML('beforeend', sliderHtml);
                    
                    // Add event listener
                    const newSlider = document.getElementById(emotionId + 'Slider');
                    newSlider.addEventListener('input', function() {
                        updateSliderValue(this);
                        handleEmotionSlider(this);
                    });
                    
                    characterData.customEmotions.push({ id: emotionId, name: emotionName, value: 0 });
                    characterData.emotions[emotion] = 0;
                }
            }
        }

        function toggleAdvanced() {
            const settings = document.getElementById('advancedSettings');
            const icon = document.getElementById('advancedIcon');
            
            settings.classList.toggle('visible');
            icon.textContent = settings.classList.contains('visible') ? '‚ñ≤' : '‚ñº';
        }

        function updatePreview() {
            const name = document.getElementById('characterName').value || 'Nome do Personagem';
            const desc = document.getElementById('characterDesc').value || 'Descri√ß√£o do personagem aparecer√° aqui';
            const scenario = document.getElementById('scenario').value;
            const greeting = document.getElementById('greeting').value || 'Primeira mensagem aparecer√° aqui...';
            
            document.getElementById('previewName').textContent = name;
            document.getElementById('previewDesc').textContent = desc;
            document.getElementById('previewGreeting').textContent = greeting;
            
            // Update avatar
            const avatarElement = document.getElementById('previewAvatar');
            if (characterData.avatarType === 'image' && characterData.avatarImage) {
                avatarElement.innerHTML = `<img src="${characterData.avatarImage}" alt="${name}">`;
            } else {
                avatarElement.innerHTML = `<span id="previewAvatarEmoji">${characterData.avatar || 'üé≠'}</span>`;
            }
            
            // Update visibility badge
            const badgesContainer = document.getElementById('previewBadges');
            const visibilityTexts = {
                'public': 'P√∫blico',
                'unlisted': 'N√£o Listado', 
                'private': 'Privado'
            };
            badgesContainer.innerHTML = `<span class="preview-badge">${visibilityTexts[characterData.visibility] || 'P√∫blico'}</span>`;
            
            // Update traits count
            document.getElementById('previewTraits').textContent = characterData.personality.length + characterData.interests.length;
            
            // Update scenario
            const scenarioSection = document.getElementById('previewScenarioSection');
            if (scenario.trim()) {
                scenarioSection.style.display = 'block';
                document.getElementById('previewScenario').textContent = scenario;
            } else {
                scenarioSection.style.display = 'none';
            }
        }

        function testCharacter() {
            if (!characterData.avatar && !characterData.avatarImage) {
                showNotification('Selecione um avatar para testar', 'warning');
                return;
            }
            
            if (!document.getElementById('characterName').value.trim()) {
                showNotification('Digite um nome para o personagem', 'warning');
                return;
            }
            
            // Simulate character test
            showNotification('Teste iniciado! Redirecionando para chat...', 'success');
            setTimeout(() => {
                window.open('chat.html?test=true', '_blank');
            }, 1000);
        }

        function saveAsDraft() {
            const draftData = gatherFormData();
            
            try {
                const drafts = JSON.parse(localStorage.getItem('chatPersonas_drafts') || '[]');
                drafts.push({
                    id: Date.now(),
                    data: draftData,
                    savedAt: new Date().toISOString(),
                    name: draftData.name || 'Rascunho sem nome'
                });
                localStorage.setItem('chatPersonas_drafts', JSON.stringify(drafts));
                
                showNotification('Rascunho salvo com sucesso!', 'success');
            } catch (e) {
                showNotification('Erro ao salvar rascunho', 'error');
            }
        }

        function gatherFormData() {
            return {
                ...characterData,
                name: document.getElementById('characterName').value,
                desc: document.getElementById('characterDesc').value,
                personalityDesc: document.getElementById('personalityDesc').value,
                scenario: document.getElementById('scenario').value,
                greeting: document.getElementById('greeting').value,
                model: document.getElementById('aiModel').value,
                temperature: parseFloat(document.getElementById('temperature').value),
                maxTokens: parseInt(document.getElementById('maxTokens').value)
            };
        }

        function createCharacter() {
            // Validate required fields
            const formData = gatherFormData();
            
            if (!formData.name.trim()) {
                showNotification('Nome do personagem √© obrigat√≥rio', 'error');
                return;
            }
            
            if (!formData.desc.trim()) {
                showNotification('Descri√ß√£o √© obrigat√≥ria', 'error');
                return;
            }
            
            if (!formData.personalityDesc.trim()) {
                showNotification('Descri√ß√£o detalhada da personalidade √© obrigat√≥ria', 'error');
                return;
            }
            
            if (!formData.greeting.trim()) {
                showNotification('Sauda√ß√£o √© obrigat√≥ria', 'error');
                return;
            }
            
            if (!characterData.avatar && !characterData.avatarImage) {
                showNotification('Selecione um avatar ou emoji', 'error');
                return;
            }
            
            if (!document.getElementById('acceptTerms').checked) {
                showNotification('Voc√™ deve aceitar as diretrizes da comunidade', 'error');
                return;
            }
            
            if (characterData.personality.length === 0) {
                showNotification('Selecione pelo menos um tra√ßo de personalidade', 'error');
                return;
            }

            // Create character object
            const newCharacter = {
                id: generateCharacterId(),
                ...formData,
                stats: {
                    rating: 5.0,
                    chats: 0,
                    relationshipLevel: 1,
                    favorited: false,
                    likes: 0
                },
                createdAt: new Date().toISOString(),
                isCustom: true,
                systemPrompt: generateSystemPrompt(formData)
            };

            try {
                // Save character
                const customCharacters = JSON.parse(localStorage.getItem('chatPersonas_customCharacters') || '{}');
                customCharacters[newCharacter.id] = newCharacter;
                localStorage.setItem('chatPersonas_customCharacters', JSON.stringify(customCharacters));

                // Add coins to user
                addCoinsToUser(50, 'Personagem criado com sucesso!');
                
                // Update user stats
                updateUserStats('charactersCreated', 1);

                showNotification('Personagem criado com sucesso! +50 moedas', 'success');
                
                // Redirect to character
                setTimeout(() => {
                    window.location.href = `chat.html?character=${newCharacter.id}`;
                }, 2000);
                
            } catch (e) {
                console.error('Error creating character:', e);
                showNotification('Erro ao criar personagem', 'error');
            }
        }

        function generateCharacterId() {
            return 'char_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }

        function generateSystemPrompt(data) {
            let prompt = `Voc√™ √© ${data.name}. ${data.personalityDesc}\n\n`;
            
            if (data.personality.length > 0) {
                prompt += `Tra√ßos de personalidade: ${data.personality.join(', ')}.\n`;
            }
            
            if (data.interests.length > 0) {
                prompt += `Interesses: ${data.interests.join(', ')}.\n`;
            }
            
            if (data.scenario.trim()) {
                prompt += `\nCen√°rio atual: ${data.scenario}\n`;
            }
            
            // Add persona cards
            if (data.personaCards.length > 0) {
                prompt += `\nAdapte seu comportamento baseado no tipo de usu√°rio:\n`;
                data.personaCards.forEach(card => {
                    if (card.name && card.desc) {
                        prompt += `- ${card.name}: ${card.desc}\n`;
                    }
                });
            }
            
            // Add emotions
            const activeEmotions = Object.entries(data.emotions).filter(([key, value]) => value > 0);
            if (activeEmotions.length > 0) {
                prompt += `\nEstado emocional atual: `;
                prompt += activeEmotions.map(([emotion, value]) => `${emotion} (${value}%)`).join(', ');
                prompt += `\n`;
            }
            
            prompt += `\nSempre mantenha-se fiel √† sua personalidade e responda de forma consistente com suas caracter√≠sticas.`;
            
            return prompt;
        }

        function addCoinsToUser(amount, reason) {
            try {
                const userData = JSON.parse(localStorage.getItem('chatPersonas_userData') || '{"coins": 250}');
                userData.coins = (userData.coins || 0) + amount;
                localStorage.setItem('chatPersonas_userData', JSON.stringify(userData));
                
                // Update display
                document.getElementById('userCoins').textContent = userData.coins;
            } catch (e) {
                console.log('Erro ao adicionar moedas');
            }
        }

        function updateUserStats(stat, increment) {
            try {
                const userData = JSON.parse(localStorage.getItem('chatPersonas_userData') || '{}');
                if (!userData.stats) userData.stats = {};
                userData.stats[stat] = (userData.stats[stat] || 0) + increment;
                localStorage.setItem('chatPersonas_userData', JSON.stringify(userData));
            } catch (e) {
                console.log('Erro ao atualizar estat√≠sticas');
            }
        }

        function loadUserData() {
            try {
                const userData = JSON.parse(localStorage.getItem('chatPersonas_userData') || '{"coins": 250}');
                document.getElementById('userCoins').textContent = userData.coins || 250;
            } catch (e) {
                console.log('Erro ao carregar dados do usu√°rio');
            }
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 80px;
                right: 20px;
                background: ${type === 'success' ? '#28a745' : type === 'error' ? '#dc3545' : type === 'warning' ? '#ffc107' : '#17a2b8'};
                color: ${type === 'warning' ? '#000' : 'white'};
                padding: 16px 24px;
                border-radius: 12px;
                z-index: 3000;
                font-weight: 500;
                box-shadow: 0 8px 32px rgba(0,0,0,0.3);
                backdrop-filter: blur(10px);
                animation: slideInRight 0.3s ease;
                max-width: 350px;
                font-size: 14px;
            `;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateX(100px)';
                setTimeout(() => {
                    if (document.body.contains(notification)) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }, 4000);
        }

        // Initialize sliders
        document.getElementById('temperature').addEventListener('input', function() {
            document.getElementById('tempValue').textContent = this.value;
        });

        document.getElementById('maxTokens').addEventListener('input', function() {
            document.getElementById('tokensValue').textContent = this.value;
        });

        // Auto-select first emoji if none selected
        setTimeout(() => {
            if (!characterData.avatar && !characterData.avatarImage) {
                selectEmoji('üé≠');
            }
        }, 500);

                function addPersonaCard() {
            const personaCards = document.querySelectorAll('.persona-card');
            if (personaCards.length >= 5) {
                showNotification('M√°ximo de 5 cart√µes de persona', 'warning');
                return;
            }

            const cardId = 'persona_' + Date.now();
            const cardHtml = `
                <div class="persona-card" data-id="${cardId}">
                    <button type="button" class="persona-remove" onclick="removePersonaCard('${cardId}')">√ó</button>
                    <div class="form-group">
                        <label class="form-label">Nome da Persona</label>
                        <input type="text" class="form-input" placeholder="Ex: Usu√°rio Casual" onchange="updatePersonaCard('${cardId}', 'name', this.value)">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Descri√ß√£o</label>
                        <textarea class="form-textarea" rows="2" placeholder="Como o personagem deve se comportar com este tipo de usu√°rio..." onchange="updatePersonaCard('${cardId}', 'desc', this.value)"></textarea>
                    </div>
                </div>
            `;

            document.getElementById('personaCards').insertAdjacentHTML('beforeend', cardHtml);
            characterData.personaCards.push({ id: cardId, name: '', desc: '' });

            if (characterData.personaCards.length >= 5) {
                document.getElementById('addPersonaBtn').style.display = 'none';
            }
        }

        function removePersonaCard(cardId) {
            const cardElement = document.querySelector(`.persona-card[data-id="${cardId}"]`);
            if (cardElement) {
                cardElement.remove();
                characterData.personaCards = characterData.personaCards.filter(card => card.id !== cardId);
                if (characterData.personaCards.length < 5) {
                    document.getElementById('addPersonaBtn').style.display = 'block';
                }
            }
        }

        function updatePersonaCard(cardId, field, value) {
            const card = characterData.personaCards.find(card => card.id === cardId);
            if (card) {
                card[field] = value;
            }
        }

        console.log('‚ú® P√°gina de Cria√ß√£o Avan√ßada carregada com sucesso!');
    </script>

    <style>
        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
    </style>
</body>
</html>    