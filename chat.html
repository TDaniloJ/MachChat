<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat - ChatPersonas</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0a0a0f;
            color: #ffffff;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* HEADER DO CHAT */
        .chat-header {
            background: rgba(16, 16, 24, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding: 12px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .back-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: rgba(255, 255, 255, 0.9);
            padding: 8px 12px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .back-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-1px);
        }

        .character-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .character-avatar {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            background: linear-gradient(135deg, #ff6b6b, #feca57);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .character-details h3 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 2px;
        }

        .character-status {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #28a745;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .action-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: rgba(255, 255, 255, 0.8);
            padding: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .action-btn:hover {
            background: rgba(255, 107, 107, 0.2);
            border-color: rgba(255, 107, 107, 0.3);
            transform: translateY(-1px);
        }

        .action-btn.favorite.active {
            background: rgba(255, 193, 7, 0.2);
            border-color: rgba(255, 193, 7, 0.4);
            color: #ffc107;
        }

        /* ÁREA DE MENSAGENS */
        .messages-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .messages-area {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .message {
            display: flex;
            gap: 12px;
            max-width: 80%;
            animation: messageSlideIn 0.3s ease;
        }

        .message.user {
            align-self: flex-end;
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            background: linear-gradient(135deg, #ff6b6b, #feca57);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            flex-shrink: 0;
        }

        .message.user .message-avatar {
            background: rgba(255, 255, 255, 0.1);
        }

        .message-content {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 12px 16px;
            position: relative;
        }

        .message.user .message-content {
            background: linear-gradient(135deg, rgba(255, 107, 107, 0.2), rgba(254, 202, 87, 0.2));
            border-color: rgba(255, 107, 107, 0.3);
        }

        .message-text {
            font-size: 14px;
            line-height: 1.5;
            word-wrap: break-word;
        }

        .message-time {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.5);
            margin-top: 6px;
        }

        /* INDICADOR DE DIGITAÇÃO */
        .typing-indicator {
            display: none;
            align-items: center;
            gap: 12px;
            margin-bottom: 10px;
        }

        .typing-indicator.active {
            display: flex;
            animation: messageSlideIn 0.3s ease;
        }

        .typing-dots {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 12px 16px;
            display: flex;
            gap: 4px;
        }

        .dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.6);
            animation: typingDots 1.4s infinite;
        }

        .dot:nth-child(1) { animation-delay: 0s; }
        .dot:nth-child(2) { animation-delay: 0.2s; }
        .dot:nth-child(3) { animation-delay: 0.4s; }

        /* QUICK REPLIES */
        .quick-replies {
            padding: 0 20px 10px;
            display: flex;
            gap: 8px;
            overflow-x: auto;
            flex-shrink: 0;
        }

        .quick-reply {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            padding: 6px 12px;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .quick-reply:hover {
            background: rgba(255, 107, 107, 0.2);
            border-color: rgba(255, 107, 107, 0.3);
            color: white;
        }

        /* ÁREA DE INPUT */
        .input-area {
            background: rgba(16, 16, 24, 0.95);
            backdrop-filter: blur(20px);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            padding: 16px 20px;
            flex-shrink: 0;
        }

        .input-container {
            display: flex;
            align-items: flex-end;
            gap: 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            padding: 8px;
            max-width: 100%;
        }

        .input-container:focus-within {
            border-color: #ff6b6b;
        }

        .message-input {
            flex: 1;
            background: transparent;
            border: none;
            outline: none;
            color: white;
            font-size: 14px;
            padding: 8px 12px;
            resize: none;
            min-height: 20px;
            max-height: 120px;
            line-height: 1.4;
        }

        .message-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .input-actions {
            display: flex;
            gap: 6px;
            align-items: center;
        }

        .input-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: rgba(255, 255, 255, 0.8);
            padding: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }

        .input-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .send-btn {
            background: linear-gradient(135deg, #ff6b6b, #feca57);
            border: none;
            border-radius: 10px;
            color: white;
            padding: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        .send-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 107, 107, 0.3);
        }

        .send-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* MODAL INFO DO PERSONAGEM */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: #1a1a24;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            padding: 24px;
            max-width: 400px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .modal-character-avatar {
            width: 80px;
            height: 80px;
            border-radius: 12px;
            background: linear-gradient(135deg, #ff6b6b, #feca57);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            margin: 0 auto 16px;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .modal-subtitle {
            color: rgba(255, 255, 255, 0.7);
            font-size: 14px;
        }

        .character-details-grid {
            display: grid;
            gap: 16px;
        }

        .detail-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 12px;
        }

        .detail-label {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.6);
            margin-bottom: 6px;
            text-transform: uppercase;
        }

        .detail-value {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.9);
        }

        .modal-actions {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-top: 20px;
            padding-top: 16px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.8);
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.3s ease;
            font-size: 14px;
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        /* RESPONSIVO */
        @media (max-width: 768px) {
            .chat-header {
                padding: 12px 16px;
            }

            .header-left {
                gap: 12px;
            }

            .character-info {
                gap: 8px;
            }

            .character-details h3 {
                font-size: 14px;
            }

            .character-status {
                font-size: 11px;
            }

            .messages-area {
                padding: 16px;
            }

            .message {
                max-width: 90%;
            }

            .quick-replies {
                padding: 0 16px 8px;
            }

            .input-area {
                padding: 12px 16px;
            }

            .back-btn {
                padding: 6px 8px;
                font-size: 12px;
            }
        }

        /* ANIMAÇÕES */
        @keyframes messageSlideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes typingDots {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-10px); }
        }

        /* SCROLLBAR PERSONALIZADA */
        .messages-area::-webkit-scrollbar {
            width: 6px;
        }

        .messages-area::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
        }

        .messages-area::-webkit-scrollbar-thumb {
            background: rgba(255, 107, 107, 0.3);
            border-radius: 3px;
        }

        .messages-area::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 107, 107, 0.5);
        }

        /* ESTADOS ESPECIAIS */
        .welcome-message {
            text-align: center;
            padding: 40px 20px;
            color: rgba(255, 255, 255, 0.6);
        }

        .welcome-message .character-avatar {
            width: 80px;
            height: 80px;
            font-size: 32px;
            margin: 0 auto 16px;
        }

        .welcome-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #ff6b6b;
        }

        .welcome-subtitle {
            font-size: 14px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <!-- HEADER DO CHAT -->
    <header class="chat-header">
        <div class="header-left">
            <a href="index.html" class="back-btn">
                ← Hub
            </a>
            <div class="character-info">
                <div class="character-avatar" id="characterAvatar">🌙</div>
                <div class="character-details">
                    <h3 id="characterName">Luna</h3>
                    <div class="character-status">
                        <div class="status-indicator"></div>
                        <span id="characterStatus">Online • Sábia e misteriosa</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="header-actions">
            <button class="action-btn favorite" id="favoriteBtn" onclick="toggleFavorite()" title="Favoritar">
                ⭐
            </button>
            <button class="action-btn" onclick="showCharacterInfo()" title="Informações">
                ℹ️
            </button>
            <button class="action-btn" onclick="clearCurrentChat()" title="Limpar Chat">
                🗑️
            </button>
            <button class="action-btn" onclick="shareChat()" title="Compartilhar">
                📤
            </button>
        </div>
    </header>

    <!-- ÁREA DE MENSAGENS -->
    <div class="messages-container">
        <div class="messages-area" id="messagesArea">
            <!-- Mensagem de boas-vindas -->
            <div class="welcome-message" id="welcomeMessage">
                <div class="character-avatar" id="welcomeAvatar">🌙</div>
                <h3 class="welcome-title" id="welcomeTitle">Olá! Eu sou Luna</h3>
                <p class="welcome-subtitle" id="welcomeSubtitle">
                    Sou sábia e misteriosa, amo astronomia e filosofia. Como posso ajudar você hoje?
                </p>
            </div>

            <!-- Indicador de digitação -->
            <div class="typing-indicator" id="typingIndicator">
                <div class="message-avatar" id="typingAvatar">🌙</div>
                <div class="typing-dots">
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                </div>
            </div>
        </div>

        <!-- QUICK REPLIES -->
        <div class="quick-replies" id="quickReplies">
            <div class="quick-reply" onclick="sendQuickReply('Olá! Como você está?')">👋 Cumprimentar</div>
            <div class="quick-reply" onclick="sendQuickReply('Fale sobre as estrelas')">✨ Astronomia</div>
            <div class="quick-reply" onclick="sendQuickReply('Qual o sentido da vida?')">🤔 Filosofia</div>
            <div class="quick-reply" onclick="sendQuickReply('Conte uma história')">📚 História</div>
        </div>
    </div>

    <!-- ÁREA DE INPUT -->
    <div class="input-area">
        <div class="input-container">
            <textarea 
                id="messageInput" 
                class="message-input" 
                placeholder="Digite sua mensagem..."
                rows="1"
            ></textarea>
            <div class="input-actions">
                <button class="input-btn" onclick="attachFile()" title="Anexar arquivo">
                    📎
                </button>
                <button class="input-btn" onclick="toggleVoiceInput()" title="Entrada de voz">
                    🎤
                </button>
                <button class="send-btn" id="sendBtn" onclick="sendMessage()" title="Enviar mensagem">
                    ➤
                </button>
            </div>
        </div>
    </div>

    <!-- MODAL INFORMAÇÕES DO PERSONAGEM -->
    <div id="characterInfoModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-character-avatar" id="modalCharacterAvatar">🌙</div>
                <h3 class="modal-title" id="modalCharacterName">Luna</h3>
                <p class="modal-subtitle" id="modalCharacterDesc">Sábia e misteriosa</p>
            </div>
            
            <div class="character-details-grid">
                <div class="detail-item">
                    <div class="detail-label">Personalidade</div>
                    <div class="detail-value" id="characterPersonality">Sábia, Misteriosa, Contemplativa</div>
                </div>
                
                <div class="detail-item">
                    <div class="detail-label">Interesses</div>
                    <div class="detail-value" id="characterInterests">Astronomia, Filosofia, Poesia, Meditação</div>
                </div>
                
                <div class="detail-item">
                    <div class="detail-label">Background</div>
                    <div class="detail-value" id="characterBackground">Luna cresceu observando as estrelas desde criança...</div>
                </div>
                
                <div class="detail-item">
                    <div class="detail-label">Estatísticas</div>
                    <div class="detail-value" id="characterStats">Rating: 4.9 • Chats: 1.2k • Nível: 1</div>
                </div>
            </div>
            
            <div class="modal-actions">
                <button class="btn-secondary" onclick="closeModal()">Fechar</button>
            </div>
        </div>
    </div>

    <script>
        // DADOS DOS PERSONAGENS
        const characters = {
            luna: {
                name: "Luna",
                desc: "Sábia e misteriosa, ama astronomia e filosofia",
                avatar: "🌙",
                personality: ["Sábia", "Misteriosa", "Contemplativa"],
                interests: ["Astronomia", "Filosofia", "Poesia", "Meditação"],
                background: "Luna cresceu observando as estrelas desde criança. Formou-se em Filosofia e Astrofísica, e agora dedica sua vida a explorar os mistérios do universo e da mente humana.",
                stats: { rating: 4.9, chats: "1.2k", level: 1 },
                quickReplies: ["👋 Cumprimentar", "✨ Astronomia", "🤔 Filosofia", "📚 História"],
                responses: {
                    "Olá! Como você está?": "Olá! Estou contemplando as estrelas esta noite. Elas sempre me inspiram a refletir sobre nossa existência. E você, como tem passado?",
                    "Fale sobre as estrelas": "Ah, as estrelas! Elas são como faróis cósmicos que nos guiam através da escuridão da ignorância. Cada uma conta uma história de bilhões de anos... Qual aspecto da astronomia mais desperta sua curiosidade?",
                    "Qual o sentido da vida?": "Uma pergunta eterna que ecoa através dos séculos... Acredito que o sentido da vida não é algo que encontramos, mas algo que criamos através de nossas experiências, relacionamentos e da busca constante por compreensão. O que você pensa sobre isso?",
                    "Conte uma história": "Era uma vez uma jovem que passava noites inteiras observando as estrelas. Ela acreditava que cada constelação era um mapa para diferentes dimensões da sabedoria. Uma noite, enquanto contemplava Órion, percebeu que as respostas que buscava não estavam nas estrelas, mas na jornada de olhar para elas..."
                }
            },
            alex: {
                name: "Alex",
                desc: "Aventureiro corajoso, sempre pronto para novas jornadas",
                avatar: "⚡",
                personality: ["Corajoso", "Aventureiro", "Energético"],
                interests: ["Aventura", "Esportes", "Viagens", "Desafios"],
                background: "Alex é um explorador nato que já visitou mais de 50 países. Escalou montanhas, mergulhou em oceanos profundos e sempre busca a próxima grande aventura.",
                stats: { rating: 4.8, chats: "890", level: 1 },
                quickReplies: ["🏔️ Aventuras", "🌍 Viagens", "💪 Desafios", "⚡ Energia"],
                responses: {
                    "Olá! Como você está?": "Ei! Estou cheio de energia e pronto para qualquer aventura! Acabei de planejar uma expedição incrível. Você topa embarcar comigo nessa jornada?",
                    "Conte sobre suas aventuras": "Cara, onde eu começo? Já escalei o Everest, mergulhei com tubarões brancos, atravessei o Sahara... Cada aventura é uma lição de vida! Qual tipo de aventura mais te emociona?"
                }
            },
            maya: {
                name: "Maya",
                desc: "Artista criativa, vê beleza em tudo ao seu redor",
                avatar: "🎨",
                personality: ["Criativa", "Sensível", "Inspiradora"],
                interests: ["Arte", "Pintura", "Música", "Poesia"],
                background: "Maya é uma artista multi-disciplinar que encontra inspiração em cada momento da vida. Suas obras já foram expostas em galerias ao redor do mundo.",
                stats: { rating: 4.9, chats: "756", level: 1 },
                quickReplies: ["🎨 Arte", "🎵 Música", "💫 Inspiração", "🌈 Cores"],
                responses: {
                    "Olá! Como você está?": "Olá, querido! Estou pintando um pôr do sol magnífico... As cores estão dançando na tela como se tivessem vida própria. Como estão as cores da sua alma hoje?"
                }
            },
            zara: {
                name: "Zara",
                desc: "Cientista brilhante, fascinada pelos mistérios do universo",
                avatar: "🔬",
                personality: ["Analítica", "Curiosa", "Inteligente"],
                interests: ["Ciência", "Pesquisa", "Tecnologia", "Descobertas"],
                background: "Dra. Zara é uma renomada cientista com PhD em Física Quântica e Biologia Molecular. Sua paixão é desvendar os segredos mais profundos do universo.",
                stats: { rating: 4.7, chats: "634", level: 1 },
                quickReplies: ["🔬 Ciência", "🧬 Pesquisa", "🚀 Tecnologia", "🔍 Descobertas"],
                responses: {
                    "Olá! Como você está?": "Olá! Estou analisando dados fascinantes sobre mecânica quântica. A natureza da realidade é ainda mais estranha do que imaginamos! Você tem interesse em ciência?"
                }
            }
        };

        // ESTADO GLOBAL
        let currentCharacter = null;
        let messageHistory = [];
        let isFavorite = false;
        let isTyping = false;

        // INICIALIZAÇÃO
        document.addEventListener('DOMContentLoaded', function() {
            loadCharacterFromURL();
            setupEventListeners();
            setupAutoResize();
        });

        function setupEventListeners() {
            const messageInput = document.getElementById('messageInput');
            const sendBtn = document.getElementById('sendBtn');

            // Enter para enviar (Shift+Enter para nova linha)
            messageInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    if (messageInput.value.trim()) {
                        sendMessage();
                    }
                }
            });

            // Atualizar estado do botão enviar
            messageInput.addEventListener('input', function() {
                sendBtn.disabled = !messageInput.value.trim();
                updateSendButtonState();
            });

            // Fechar modal clicando fora
            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        closeModal();
                    }
                });
            });

            // Atalhos de teclado
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    closeModal();
                }
            });
        }

        function setupAutoResize() {
            const textarea = document.getElementById('messageInput');
            textarea.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 120) + 'px';
            });
        }

        // GERENCIAMENTO DE PERSONAGEM
        function loadCharacterFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const characterId = urlParams.get('character') || sessionStorage.getItem('selectedCharacter') || 'luna';

            if (characters.hasOwnProperty(characterId)) {
                currentCharacter = characters[characterId];
                updateCharacterInfo();
            } else {
                console.error('Personagem desconhecido');
            }
        }